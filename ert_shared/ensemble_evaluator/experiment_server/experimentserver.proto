syntax = "proto3";

package experimentserver;
//import "google/protobuf/timestamp.proto";


service Experimentserver {
	rpc connect_ensemble(stream EnsembleMessage) returns(stream EnsembleState);
	rpc connect_job(stream JobMessage) returns(stream JobState);
}

message JobId {
  string experimentId = 1;
  string ensembleId = 2;
  uint64 realization = 3;
  uint64 step = 4;
  uint64 job = 5;
}

enum RunState {
    UNKNOWN   = 0;
    STARTED   = 1;
    RUNNING   = 2;
    DONE      = 3;
    FAILED    = 4;
    CANCELLED = 5;
}

message EnsembleState {
  RunState state = 1;
  uint64 startTime = 2;
  uint64 endTime = 3;
}

message JobState {
  enum State {
    UNKNOWN   = 0;
    STARTED   = 1;
    RUNNING   = 2;
    DONE      = 3;
    FAILED    = 4;
    CANCELLED = 5;
  };
  State state = 1;
  uint64 currentMemory = 2;
  uint64 maxMemory = 3;

//  google.protobuf.Timestamp startTime = 1;
//  google.protobuf.Timestamp endTime = 2;
  uint64 startTime = 4;
  uint64 endTime = 5;
}

message EnsembleMessage {
  oneof event {
  	JobId id = 1;
  	RunState state = 2;
  }
}

message JobMessage {
  oneof event {
  	JobId id = 1;
  	JobState state = 2;
  }
}
